# Cargo configuration for EdgeVec
# Enables CPU-specific optimizations for maximum performance

[build]
# Enable native CPU features (AVX2, FMA, SSE4.2, etc.) for maximum performance
# This is critical for SIMD-accelerated quantized distance calculations
rustflags = [
    "-C", "target-cpu=native",
    "-C", "opt-level=3",
    "-C", "llvm-args=-enable-no-infs-fp-math",  # Aggressive float optimizations
    "-C", "llvm-args=-enable-no-nans-fp-math",  # Aggressive float optimizations
]

# W30.1: WASM SIMD128 Configuration
# Enables SIMD instructions for 2-3x performance improvement in browsers
# Supported: Chrome 91+, Firefox 89+, Safari 16.4+ (macOS only, NOT iOS)
[target.wasm32-unknown-unknown]
rustflags = ["-C", "target-feature=+simd128"]

[profile.release]
# Additional release optimizations
lto = "fat"            # Full LTO for maximum performance
codegen-units = 1      # Better optimization, slower compile
panic = "abort"        # Smaller, faster panic handling

[profile.bench]
# Inherit from release and add specific bench opts
inherits = "release"
debug = 1              # Minimal debug info for profiling

# W18.2: xtask alias for CI simulation
# Allows using `cargo xtask` instead of `cargo run -p xtask --`
[alias]
xtask = "run --package xtask --"
