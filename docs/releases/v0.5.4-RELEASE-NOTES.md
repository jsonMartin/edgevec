# EdgeVec v0.5.4 Release Notes

**Release Date:** Week 25, 2025 (Pending)
**Type:** Bug Fix / Mobile Compatibility Release
**Priority:** Critical (iOS Safari support)

---

## Summary

This release focuses on **iOS Safari compatibility** and **mobile responsive design** fixes discovered during Week 25 Day 3 testing on iPhone 15 Pro (iOS 18.2).

---

## Critical Fixes

### [C1] WASM Module Loading Improvements

**Issue:** `TypeError: wasmModule.parse_filter_js is not a function` on iOS Safari

**Root Cause Analysis:**
- The WASM module exports ARE correct (verified in `pkg/edgevec.js:2189`)
- The issue was insufficient error handling and path fallback logic
- iOS Safari may fail silently on certain import scenarios

**Fix Applied:**
- Added multi-path fallback for WASM module loading
- Added explicit export verification after module initialization
- Added detailed console logging for debugging (`[EdgeVec]` prefix)
- Added iOS-specific error hints for users

**Files Modified:**
- `wasm/examples/filter-playground.html` (lines 1155-1237)

**Verification:**
```javascript
// Before calling parse_filter_js, we now verify:
const requiredExports = ['parse_filter_js', 'validate_filter_js', 'EdgeVec', 'EdgeVecConfig'];
const missingExports = requiredExports.filter(exp => typeof wasmModule[exp] === 'undefined');
if (missingExports.length > 0) {
    throw new Error(`WASM module incomplete. Missing: ${missingExports.join(', ')}`);
}
```

---

### [C2][C3] Mobile Responsive Layout Fixes

**Issue:** Demo Catalog (index.html) had horizontal overflow on iOS Safari

**Root Cause:**
- Grid layout with `minmax(340px, 1fr)` causing overflow on screens <340px
- Lack of iOS-specific overflow handling
- Touch targets smaller than Apple's 44x44px recommendation

**Fix Applied:**
- Added `@supports (-webkit-touch-callout: none)` iOS-specific styles
- Added overflow protection: `overflow-x: hidden; -webkit-overflow-scrolling: touch;`
- Added word-wrap for long text content
- Added 44x44px minimum touch targets for interactive elements
- Added extra small screen breakpoint `@media (max-width: 375px)` for iPhone SE support

**Files Modified:**
- `wasm/examples/index.html` (lines 1186-1295)

---

## Testing Improvements

### iOS Safari Debugging

All demo pages now include comprehensive debugging output:

```javascript
console.log('[EdgeVec] Platform detection:', { isIOS, isSafari, userAgent });
console.log('[EdgeVec] Module exports:', Object.keys(wasmModule));
console.log('[EdgeVec] All required exports verified:', { ... });
```

This helps diagnose issues without needing Safari Web Inspector connected.

---

## Verification Checklist

Before release, verify on iOS Safari (iPhone 15 Pro or similar):

- [ ] Demo Catalog loads without horizontal overflow
- [ ] All demo cards are tappable (44x44px targets)
- [ ] Filter Playground WASM loads with console logs visible
- [ ] `parse_filter_js` is exported (check console)
- [ ] Filter parsing works (try: `category = "test"`)
- [ ] Benchmark Dashboard loads (data may show NaN - separate issue)
- [ ] Soft Delete demo loads and basic operations work

---

## Files Changed Summary

| File | Changes |
|:-----|:--------|
| `wasm/examples/filter-playground.html` | iOS debugging, multi-path WASM loading, export verification |
| `wasm/examples/index.html` | iOS-specific CSS, touch targets, extra-small breakpoint |
| `docs/fixes/2025-12-19_WASM_BUILD_FIX.md` | Investigation documentation |
| `docs/investigations/2025-12-19_IOS_FILTER_INCONSISTENCY_ROOT_CAUSE.md` | Root cause analysis |
| `docs/reviews/2025-12-19_W25_DAY3_IOS_TESTING_REJECTED.md` | Hostile review rejection |
| `docs/planning/W25_DAY3_REMEDIATION_PLAN.md` | Remediation plan |
| `docs/mobile/IOS_TEST_RESULTS.md` | Updated with actual test results |

---

## Remaining Known Issues

### [M1] Performance Degradation at 15k+ Vectors
- **Status:** Not fixed in v0.5.4
- **Description:** iOS Safari shows lag with 15k+ vectors (research predicted 50k safe)
- **Workaround:** Use quantized mode, limit to <15k vectors on mobile

### [C5] Benchmark Dashboard NaN Results
- **Status:** Not fixed in v0.5.4
- **Description:** Benchmark returns 0 results and +NaN%
- **Root Cause:** Timing API precision or division by zero
- **Planned:** v0.5.5

### [C6] Soft Delete Compaction
- **Status:** Not fixed in v0.5.4
- **Description:** Compaction may not reset tombstones on iOS
- **Root Cause:** Needs investigation after WASM loading is confirmed working
- **Planned:** v0.5.5

### pkg/package.json Corruption
- **Status:** External process issue
- **Description:** File keeps reverting to `{ "dependencies": { "edgevec": "^0.5.1" } }`
- **Workaround:** Delete and run `wasm-pack build` to regenerate
- **Note:** Does NOT affect WASM functionality, only npm publishing

---

## Upgrade Instructions

### From v0.5.3

1. **Pull latest changes:**
   ```bash
   git pull origin main
   ```

2. **Rebuild WASM:**
   ```bash
   wasm-pack build --target web --out-dir pkg
   ```

3. **Verify exports:**
   ```bash
   grep "export function parse_filter_js" pkg/edgevec.js
   ```

4. **Test on iOS Safari:**
   - Open Safari Web Inspector (from Mac)
   - Load demo pages
   - Check console for `[EdgeVec]` debug messages

---

## Compatibility Matrix

| Platform | Status | Notes |
|:---------|:-------|:------|
| Desktop Chrome | ✅ Verified | No changes needed |
| Desktop Firefox | ✅ Verified | No changes needed |
| Desktop Safari | ✅ Verified | No changes needed |
| iOS Safari 18.2 | ⚠️ Improved | Basic functionality, performance limits |
| iOS Safari 17.4+ | ⚠️ Expected | Needs verification |
| Android Chrome | ⚠️ Untested | Mobile CSS should help |

---

## Contributors

- **HOSTILE_REVIEWER:** iOS testing rejection and remediation plan
- **WASM_SPECIALIST:** Build investigation and debugging improvements
- **RUST_ENGINEER:** Root cause analysis

---

**Version:** 0.5.4
**Status:** READY FOR TESTING
**Next:** iOS Safari re-test, then merge and publish
