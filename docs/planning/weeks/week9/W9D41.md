# W9D41 — Pre-Release Validation & GitHub Setup [REVISED-PRODUCTION]

**Date:** 2025-12-13
**Phase:** Week 9 - Alpha Release (Day 1 of 5)
**Owner:** RUST_ENGINEER + DOCWRITER
**Tasks:** W9.1, W9.2
**Estimated Hours:** 10h (was 9h, +1h for rollback testing)

---

## 1. Context

This is the first day of Week 9, the final week before EdgeVec's alpha release. Week 8 validated all components and finalized documentation. Now we must perform final pre-release checks and prepare the public GitHub repository.

**Prerequisites:**
- ✅ `.claude/GATE_WEEK8_COMPLETE.md` exists (all Week 8 validation passed)
- ✅ `Cargo.toml` version = 0.2.0-alpha.1
- ✅ `CHANGELOG.md` finalized with v0.2.0-alpha.1 entry
- ✅ `README.md` finalized
- ✅ `docs/KNOWN_LIMITATIONS.md` complete

**Dependencies:**
- Week 8 complete
- **[USER]** GitHub account with repo creation permissions

---

## 2. Technical Plan

### Part 1: Pre-Release Checklist Validation (W9.1 — 7h, was 6h)

**Owner:** RUST_ENGINEER
**Type:** AGENT_ACTION

#### 2.1.1 Code Quality Validation (2h)

```bash
# Step 1: Run full test suite
cargo test --all-features --release
# Expected: All tests pass

# Step 2: Run Clippy with strict warnings
cargo clippy --all-targets --all-features -- -D warnings
# Expected: No warnings

# Step 3: Check formatting
cargo fmt --check
# Expected: No formatting issues

# Step 4: Build release binary
cargo build --release
# Expected: Builds successfully

# Step 5: Run cargo audit for security vulnerabilities
cargo audit
# Expected: No vulnerabilities (or only informational)
```

#### 2.1.2 WASM Build Validation (1.5h)

```bash
# Step 1: Build WASM package
cd wasm && wasm-pack build --target web --release
# Expected: Build successful, pkg/ directory created

# Step 2: Verify bundle size
cd wasm/pkg && ls -la *.wasm
# Expected: ~300KB uncompressed, ~148KB gzipped

# Step 3: Test npm pack
cd wasm && npm pack --dry-run
# Expected: Lists ~19 files, valid package structure

# Step 4: TypeScript type check
cd wasm && npx tsc --noEmit
# Expected: No type errors
```

#### 2.1.3 WASM Browser Smoke Test (30min)

**AGENT_ACTION:**

```bash
# Step 1: Create minimal test HTML
cat > /tmp/wasm-smoke-test.html << 'EOF'
<!DOCTYPE html>
<html>
<head><title>EdgeVec WASM Smoke Test</title></head>
<body>
<script type="module">
import init, { EdgeVecClient } from './pkg/edgevec_wasm.js';

(async () => {
  try {
    await init();
    console.log('✅ WASM module loaded');

    // Smoke test: Create client and insert vector
    const client = await EdgeVecClient.create({ dimensions: 128 });
    console.log('✅ Client created');

    const vector = new Float32Array(128).fill(0.1);
    const id = client.insert(vector);
    console.log('✅ Vector inserted, id:', id);

    const results = client.search(vector, 1);
    console.log('✅ Search returned:', results.length, 'results');

    console.log('✅✅✅ ALL SMOKE TESTS PASSED ✅✅✅');
  } catch (e) {
    console.error('❌ SMOKE TEST FAILED:', e);
  }
})();
</script>
</body>
</html>
EOF

# Step 2: Copy WASM package to test directory
cp -r wasm/pkg /tmp/

# Step 3: Serve and test (user opens browser)
cd /tmp && python -m http.server 8080
# USER: Open http://localhost:8080/wasm-smoke-test.html
# USER: Check browser console for "ALL SMOKE TESTS PASSED"
```

**Acceptance:** Browser console shows "ALL SMOKE TESTS PASSED" with no errors.

#### 2.1.4 Documentation Validation (1h)

```bash
# Step 1: Build Rust documentation
cargo doc --no-deps --all-features
# Expected: Documentation builds without warnings

# Step 2: Verify README renders correctly
# Manual check: Open README.md in GitHub preview

# Step 3: Verify CHANGELOG format
# Manual check: Follows Keep a Changelog format

# Step 4: Verify KNOWN_LIMITATIONS completeness
# Manual check: All 6 limitations documented with workarounds
```

#### 2.1.5 Benchmark Verification (1h)

```bash
# Step 1: Run quick benchmark validation
cargo bench --bench search_bench -- --sample-size 10
# Expected: Results within 10% of documented benchmarks

# Cross-reference with CHANGELOG.md:
# - 10k SQ8: ~88µs (acceptable range: 80-100µs)
# - 50k SQ8: ~167µs (acceptable range: 150-200µs)
# - 100k SQ8: ~329µs (acceptable range: 300-400µs)
```

#### 2.1.6 Rollback Procedure Testing (1h) **[PRODUCTION-CRITICAL]**

**Owner:** RUST_ENGINEER
**Type:** AGENT_ACTION

**Rationale:** You don't rehearse rollback during a production incident. You rehearse it BEFORE the incident.

```bash
# CRITICAL: Test rollback procedures before they're needed

# Step 1: Create test npm package for rollback rehearsal (15min)
mkdir -p /tmp/rollback-test
cd /tmp/rollback-test
npm init -y --scope=@test-edgevec
echo "module.exports = { version: '0.0.1-test' };" > index.js

# Step 2: Test npm publish/unpublish cycle (15min)
# NOTE: This requires npm credentials. If not available, document the dry-run commands.

# Dry-run publish (always safe)
npm publish --dry-run --access public
# Expected: Shows what would be published

# If npm credentials available, test actual cycle:
# npm publish --access public --tag test
# npm unpublish @test-edgevec/rollback-test@0.0.1-test
# Expected: Publish and unpublish succeed

# Step 3: Test git tag creation/deletion (15min)
cd /path/to/edgevec
git tag -a v0.0.0-rollback-test -m "Rollback rehearsal test tag"
git tag -l | grep rollback-test
# Expected: Tag appears

git tag -d v0.0.0-rollback-test
git tag -l | grep rollback-test
# Expected: Tag deleted (no output)

# Step 4: Test GitHub release delete workflow (15min)
# If gh CLI available:
# gh release create v0.0.0-rollback-test --notes "Test release for rollback rehearsal" --prerelease
# gh release delete v0.0.0-rollback-test --yes
# Expected: Release created and deleted successfully

# If gh CLI not available, document manual steps:
echo "Manual GitHub release deletion:"
echo "1. Go to https://github.com/[USER]/edgevec/releases"
echo "2. Click on release tag"
echo "3. Click 'Delete this release' (bottom right)"
echo "4. Confirm deletion"

# Step 5: Document rollback timing (15min)
# Measure time taken for each operation
echo "ROLLBACK TIMING BENCHMARK:"
echo "- npm unpublish: [X seconds]"
echo "- git tag delete: [X seconds]"
echo "- GitHub release delete: [X seconds]"
echo "Total time from decision to complete rollback: [X minutes]"
echo ""
echo "Target: Complete rollback in <5 minutes from decision point"
```

**Acceptance Criteria:**

| Check | Pass/Fail | Expected Output | Notes |
|:------|:----------|:----------------|:------|
| npm publish dry-run | [ ] | Shows package contents | No errors |
| git tag create/delete | [ ] | Tag appears and disappears | Local operation |
| Rollback timing documented | [ ] | Total time <5 minutes | Speed critical during incident |
| Rollback checklist exists | [ ] | Step-by-step procedure | Ready for Day 42 |

**Deliverable:** Create `docs/release/ROLLBACK_CHECKLIST.md`:

```markdown
# Emergency Rollback Checklist

**Use this checklist if v0.2.0-alpha.1 needs emergency rollback.**

## Prerequisites
- [ ] Decision made to rollback (document reason in GitHub issue)
- [ ] npm credentials ready (`npm whoami` succeeds)
- [ ] GitHub CLI authenticated (`gh auth status`)

## Rollback Steps (Target: <5 minutes)

### Step 1: Unpublish from npm (within 72h of publish)
```bash
npm unpublish @edgevec/core@0.2.0-alpha.1
```
Expected: `- @edgevec/core@0.2.0-alpha.1`

### Step 2: Delete GitHub Release
```bash
gh release delete v0.2.0-alpha.1 --yes
```
Expected: Release deleted

### Step 3: Delete Git Tag (optional, keeps history)
```bash
# Local
git tag -d v0.2.0-alpha.1

# Remote (WARNING: Destructive)
git push origin :refs/tags/v0.2.0-alpha.1
```

### Step 4: User Notification
```bash
# Mark as deprecated on npm (if unpublish window missed)
npm deprecate @edgevec/core@0.2.0-alpha.1 "CRITICAL BUG: Rolled back. Use v0.2.0-alpha.2 instead."

# Update GitHub release notes (if release not deleted)
gh release edit v0.2.0-alpha.1 --notes "⚠️ ROLLED BACK: Critical bug discovered. Use v0.2.0-alpha.2 instead."
```

### Step 5: Post-Rollback
- [ ] Create incident report: `docs/incidents/YYYY-MM-DD-rollback-v0.2.0-alpha.1.md`
- [ ] Post in GitHub issues: "v0.2.0-alpha.1 rolled back due to [reason]"
- [ ] If fixes ready, proceed with v0.2.0-alpha.2 hotfix release

## Verification
- [ ] npm shows package removed: `npm view @edgevec/core@0.2.0-alpha.1` (expect 404)
- [ ] GitHub release not visible: Visit releases page
- [ ] Community notified: Issue posted, announcements updated
```

**Acceptance Criteria (W9.1.6):**

| Check | Pass/Fail | Expected Output | Notes |
|:------|:----------|:----------------|:------|
| `cargo test` | [ ] | `test result: ok. X passed` | All tests pass |
| `cargo clippy` | [ ] | `Finished` with 0 warnings | -D warnings |
| `cargo fmt --check` | [ ] | No output (exit 0) | All formatted |
| `cargo build --release` | [ ] | `Finished release` | No errors |
| `cargo audit` | [ ] | No vulnerabilities | Security check |
| `wasm-pack build` | [ ] | `[INFO]: Your wasm pkg is ready` | WASM OK |
| WASM browser smoke test | [ ] | "ALL SMOKE TESTS PASSED" in console | Browser test |
| `npm pack --dry-run` | [ ] | ~19 files listed | Valid pkg |
| `cargo doc` | [ ] | No warnings | Docs complete |
| Benchmark validation | [ ] | Within 10% of docs | Performance stable |

**Rollback:** N/A (read-only validation, no changes to codebase)

---

### Part 2: GitHub Repository Setup (W9.2 — 3h)

**Owner:** DOCWRITER (with USER_ACTION coordination)
**Type:** MIXED (USER_ACTION for GitHub, AGENT_ACTION for git config)

#### 2.2.1 Create GitHub Repository (30min)

**[USER_ACTION REQUIRED]**

```
The user must perform these steps manually:

1. Go to https://github.com/new
2. Repository name: edgevec (or user preference)
3. Description: "High-performance vector search for Browser, Node, and Edge"
4. Visibility: Public
5. Initialize: NO README (we have our own)
6. Initialize: NO .gitignore (we have our own)
7. Initialize: NO License (we have MIT in repo)
8. Click "Create repository"
9. Copy the repository URL

IMPORTANT: Record the repository URL for next steps.
Expected format: https://github.com/[USERNAME]/edgevec.git
```

#### 2.2.2 Configure Local Git Remote (30min)

**AGENT_ACTION:**

```bash
# Step 1: Verify current git status
git status
# Expected: Clean working directory

# Step 2: Check existing remotes
git remote -v
# Expected: May be empty or have existing remote

# Step 3: Add/update GitHub remote
# If no origin exists:
git remote add origin https://github.com/[USERNAME]/edgevec.git

# If origin exists but wrong URL:
git remote set-url origin https://github.com/[USERNAME]/edgevec.git

# Step 4: Verify remote configuration
git remote -v
# Expected: origin pointing to GitHub repo
```

#### 2.2.3 Push Initial Commit (30min)

**AGENT_ACTION:**

```bash
# Step 1: Ensure on main branch
git branch -M main

# Step 2: Push to GitHub
git push -u origin main
# Expected: Successful push

# Step 3: Verify push success
git log origin/main --oneline -1
# Expected: Shows latest commit hash

# Step 4: Verify on GitHub
# Manual check: Repository shows all files on GitHub web UI
```

#### 2.2.4 Configure GitHub Repository Settings (30min)

**[USER_ACTION REQUIRED]**

```
The user must configure these settings on GitHub:

1. Go to repository Settings → General
   - Topics: vector-search, hnsw, wasm, rust, nearest-neighbor, embeddings
   - Features: Issues ON, Discussions OFF, Wiki OFF

2. Go to repository Settings → Branches
   - Add branch protection rule for 'main' (optional for alpha)

3. Verify About section displays correctly:
   - Description visible
   - Topics visible
   - License detected as MIT
```

#### 2.2.5 Create GitHub Issue Templates (30min)

**AGENT_ACTION:**

```bash
# Create .github directory structure
mkdir -p .github/ISSUE_TEMPLATE

# Bug report template will be created
# Feature request template will be created
# Question template will be created
```

**Files to create:**

`.github/ISSUE_TEMPLATE/bug_report.md`:
```markdown
---
name: Bug Report
about: Report a bug in EdgeVec
title: '[BUG] '
labels: bug
assignees: ''
---

## Description
A clear and concise description of the bug.

## Steps to Reproduce
1. ...
2. ...
3. ...

## Expected Behavior
What you expected to happen.

## Actual Behavior
What actually happened.

## Environment
- EdgeVec version:
- Platform (Browser/Node/Edge):
- OS:
- Browser (if applicable):

## Additional Context
Any other context about the problem.
```

`.github/ISSUE_TEMPLATE/feature_request.md`:
```markdown
---
name: Feature Request
about: Suggest a feature for EdgeVec
title: '[FEATURE] '
labels: enhancement
assignees: ''
---

## Problem Statement
What problem would this feature solve?

## Proposed Solution
Describe the solution you'd like.

## Alternatives Considered
Any alternative solutions or features you've considered.

## Additional Context
Any other context or screenshots.
```

#### 2.2.6 Commit and Push GitHub Configuration (30min)

**AGENT_ACTION:**

```bash
# Stage GitHub configuration files
git add .github/

# Commit
git commit -m "Add GitHub issue templates and repository configuration"

# Push
git push origin main
```

**Acceptance Criteria (W9.2):**

| Check | Pass/Fail | Verification Method | Notes |
|:------|:----------|:--------------------|:------|
| Repository created | [ ] | `gh repo view` or GitHub web UI | Public visibility |
| Remote configured | [ ] | `git remote -v` shows origin | Correct URL |
| Initial push successful | [ ] | `git log origin/main` matches local | All files pushed |
| Topics configured | [ ] | GitHub web UI shows topics | SEO visibility |
| Issue templates created | [ ] | `.github/ISSUE_TEMPLATE/` exists | Community ready |
| License detected | [ ] | GitHub shows "MIT License" | Legal compliance |

**Rollback:**

```bash
# If push fails due to authentication:
# User provides personal access token or uses SSH

# If repository needs recreation:
git remote remove origin
# User deletes GitHub repo via web UI
# Restart from step 2.2.1

# If wrong files pushed:
git reset --soft HEAD~1
git push -f origin main  # CAUTION: Force push
```

---

## 3. Tasks

### W9.1: Pre-Release Checklist Validation (7h, was 6h)

- [ ] **Code Quality** (2h)
  - [ ] Run `cargo test --all-features --release`
  - [ ] Run `cargo clippy --all-targets --all-features -- -D warnings`
  - [ ] Run `cargo fmt --check`
  - [ ] Run `cargo build --release`
  - [ ] Run `cargo audit`

- [ ] **WASM Build** (1.5h)
  - [ ] Run `wasm-pack build --target web --release`
  - [ ] Verify bundle size (~148KB gzipped)
  - [ ] Run `npm pack --dry-run`
  - [ ] Run TypeScript type check
  - [ ] Run WASM browser smoke test

- [ ] **Documentation** (1h)
  - [ ] Build Rust docs with `cargo doc --no-deps`
  - [ ] Verify README.md renders correctly
  - [ ] Verify CHANGELOG.md format
  - [ ] Verify KNOWN_LIMITATIONS.md completeness

- [ ] **Benchmarks** (1h)
  - [ ] Run quick benchmark validation
  - [ ] Verify results within 10% of documented values

- [ ] **Rollback Testing [PRODUCTION-CRITICAL]** (1h)
  - [ ] Test npm publish/unpublish dry-run
  - [ ] Test git tag create/delete
  - [ ] Test GitHub release workflow (if gh CLI available)
  - [ ] Document rollback timing (<5min target)
  - [ ] Create `docs/release/ROLLBACK_CHECKLIST.md`

### W9.2: GitHub Repository Setup (3h)

- [ ] **[USER]** Create GitHub repository
- [ ] Configure git remote locally
- [ ] Push main branch to GitHub
- [ ] **[USER]** Configure repository settings (topics, features)
- [ ] Create `.github/ISSUE_TEMPLATE/bug_report.md`
- [ ] Create `.github/ISSUE_TEMPLATE/feature_request.md`
- [ ] Commit and push GitHub configuration
- [ ] Verify all files visible on GitHub

---

## 4. Verification

### Verification Commands

```bash
# Verify W9.1 - Code quality
cargo test --all-features --release 2>&1 | tail -5
cargo clippy --all-targets --all-features -- -D warnings 2>&1 | tail -3

# Verify W9.1 - WASM
test -d wasm/pkg && echo "✅ WASM pkg exists"
ls -la wasm/pkg/*.wasm 2>/dev/null | head -1

# Verify W9.2 - Git remote
git remote -v | grep origin && echo "✅ Remote configured"

# Verify W9.2 - Push status
git log origin/main --oneline -1 && echo "✅ Pushed to GitHub"

# Verify W9.2 - Issue templates
test -f .github/ISSUE_TEMPLATE/bug_report.md && echo "✅ Bug template exists"
test -f .github/ISSUE_TEMPLATE/feature_request.md && echo "✅ Feature template exists"
```

### Acceptance Summary

| Task | Criterion | Status |
|:-----|:----------|:-------|
| W9.1 | All validation checks pass | [ ] |
| W9.1 | No security vulnerabilities | [ ] |
| W9.1 | WASM builds successfully | [ ] |
| W9.1 | Benchmarks within 10% of docs | [ ] |
| W9.2 | GitHub repository exists | [ ] |
| W9.2 | All files pushed to GitHub | [ ] |
| W9.2 | Issue templates created | [ ] |
| W9.2 | Repository settings configured | [ ] |

### Failure Modes

| Failure | Recovery Action |
|:--------|:----------------|
| Tests fail | Fix failing tests before proceeding (BLOCKER) |
| Clippy warnings | Fix all warnings before proceeding (BLOCKER) |
| Security vulnerability | Assess severity; critical = BLOCKER |
| WASM build fails | Debug wasm-pack errors; check Rust version |
| GitHub push fails | Check authentication; use PAT or SSH |
| Bundle size too large | Review included files; check wasm-opt |

---

## 5. Deliverables

| Artifact | Location | Owner | Status |
|:---------|:---------|:------|:-------|
| Pre-release validation (tests passed) | Terminal output | RUST_ENGINEER | [ ] |
| Pre-release validation (WASM built) | `wasm/pkg/` | RUST_ENGINEER | [ ] |
| GitHub repository | `https://github.com/[USER]/edgevec` | USER | [ ] |
| Git remote configured | `.git/config` | AGENT | [ ] |
| Bug report template | `.github/ISSUE_TEMPLATE/bug_report.md` | DOCWRITER | [ ] |
| Feature request template | `.github/ISSUE_TEMPLATE/feature_request.md` | DOCWRITER | [ ] |

---

## 6. Risks & Mitigations

| Risk | Probability | Impact | Mitigation |
|:-----|:------------|:-------|:-----------|
| Test regression | Low | CRITICAL | Week 8 was thorough; fix any new failures |
| Security vulnerability found | Low | High | Assess severity; patch if critical |
| GitHub authentication fails | Medium | Medium | User provides PAT or uses SSH |
| WASM build fails | Low | High | Check wasm-pack version; verify Rust toolchain |
| Benchmark regression | Low | Medium | Re-run with more samples; check environment |

---

## 7. Timeline Buffer & Contingency **[PRODUCTION-CRITICAL]**

**Estimated:** 10h
**Realistic Range:** 9-12h (based on unknowns)

### Flex Buffer Policy

**IF tasks exceed estimate by >2h:**
- Defer Day 42 by 1 day
- Use extra time for thorough validation (don't rush)
- Better to delay 1 day than ship untested release

**STOP CONDITION:**
If cumulative slip across Days 41-43 exceeds 4h, postpone entire release by 1 week.

**Why This Matters:**
- Day 41 sets quality baseline for entire release
- Rushing validation to hit timeline = bugs in production
- Better to delay and ship quality than rush and rollback

**Tracking Slip:**
- Record actual time taken for each section
- Compare to estimates
- Update next day's plan if pattern emerges

---

## 8. Next Step

After W9D41 completion:

```bash
# Mark Day 41 complete
echo "W9D41 Complete: Pre-release validation PASSED. GitHub repository READY."

# Proceed to Day 42
# Reference: docs/planning/weeks/week9/W9D42.md
```

**Pipeline:**
**W9D41** (Validation + GitHub) → W9D42 (Tag + Publish) → W9D43 (Announce) → W9D44-45 (Monitor)

---

**Ready for Execution:** Execute each task sequentially. All USER_ACTION items require manual user intervention.

---

**END OF W9D41**
