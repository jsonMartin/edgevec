# W9D42 — Git Tag & npm Package Publish [REVISED-PRODUCTION]

**Date:** 2025-12-14
**Phase:** Week 9 - Alpha Release (Day 2 of 5)
**Owner:** RUST_ENGINEER + WASM_SPECIALIST
**Tasks:** W9.3, W9.4
**Estimated Hours:** 6.5h (was 6h, +0.25h for service health check, +0.25h for retry logic)

---

## 1. Context

Day 2 is the critical release day. We create the official git tag, publish the GitHub release, and publish the npm package. These are the public-facing release artifacts that users will interact with.

**Prerequisites:**
- ✅ W9D41 complete (validation passed, GitHub repo created)
- ✅ GitHub repository exists and is accessible
- ✅ All code pushed to `origin/main`
- ✅ Pre-release validation PASSED

**Dependencies:**
- W9D41 complete
- **[USER]** npm account with publish permissions
- **[USER]** GitHub account with release creation permissions

---

## 2. Technical Plan

### Part 1: Create Git Tag & GitHub Release (W9.3 — 3.25h, was 3h)

**Owner:** RUST_ENGINEER
**Type:** MIXED (AGENT_ACTION for git, USER_ACTION for GitHub UI)

#### 2.1.0 Service Health Check (15min) **[PRODUCTION-CRITICAL]**

**Owner:** RUST_ENGINEER
**Type:** AGENT_ACTION

**Rationale:** Never publish during service outages. Check external service health BEFORE creating immutable artifacts (git tags, npm packages).

```bash
# CRITICAL: Verify all external services are healthy before proceeding

# Step 1: Check npm registry status (5min)
echo "=== npm Registry Health Check ==="
curl -I https://registry.npmjs.org/ 2>&1 | head -1
# Expected: HTTP/2 200

# If not 200, check status page:
# https://status.npmjs.org/
# Decision: If degraded, DELAY publish by 24h

# Step 2: Check GitHub API status (5min)
echo "=== GitHub API Health Check ==="
curl -I https://api.github.com/ 2>&1 | head -1
# Expected: HTTP/2 200

# Verify GitHub status page:
curl -s https://www.githubstatus.com/api/v2/status.json | grep -o '"indicator":"[^"]*"'
# Expected: "indicator":"none" (no incidents)

# If degraded, check: https://www.githubstatus.com/
# Decision: If "major outage", DELAY publish by 24h

# Step 3: Check git remote connectivity (5min)
echo "=== Git Remote Connectivity ==="
git ls-remote https://github.com/[USERNAME]/edgevec.git HEAD
# Expected: Shows HEAD commit ref

# If timeout or error:
# Decision: DELAY publish until connectivity restored
```

**Service Health Decision Matrix:**

| Service | Status | Action |
|:--------|:-------|:-------|
| npm 200 OK | ✅ Healthy | Proceed |
| npm 5xx / Timeout | ❌ Down | **ABORT**: Delay 24h, check status.npmjs.org |
| npm "degraded" | ⚠️ Degraded | **ABORT**: Delay 24h (avoid partial failure) |
| GitHub 200 OK | ✅ Healthy | Proceed |
| GitHub 5xx / Timeout | ❌ Down | **ABORT**: Delay 24h, check githubstatus.com |
| GitHub "major outage" | ❌ Major | **ABORT**: Delay 24h |
| git remote timeout | ❌ No Conn | **ABORT**: Fix network, retry |

**STOP CONDITION:**
If ANY service is unhealthy, **DO NOT PROCEED** with this day. Reschedule for next day.

**Why This Matters:**
- Scenario: You create git tag (immutable), then npm publish fails → "zombie release"
- Scenario: npm publish succeeds, GitHub release fails → Users can't find docs
- Scenario: Services have intermittent outages → Users report "sometimes works, sometimes doesn't"

**Acceptance Criteria:**

| Check | Pass/Fail | Expected Output | Notes |
|:------|:----------|:----------------|:------|
| npm registry | [ ] | 200 OK | No 5xx errors |
| GitHub API | [ ] | 200 OK | No 5xx errors |
| GitHub status | [ ] | indicator="none" | No major incidents |
| git remote | [ ] | Shows HEAD commit | Connectivity verified |

**Rollback:** N/A (read-only health check)

---

#### 2.1.1 Verify Current State (15min)

**AGENT_ACTION:**

```bash
# Step 1: Verify on main branch
git branch --show-current
# Expected: main

# Step 2: Verify working directory clean
git status
# Expected: nothing to commit, working tree clean

# Step 3: Verify up to date with origin
git fetch origin
git status
# Expected: Your branch is up to date with 'origin/main'

# Step 4: Verify version in Cargo.toml
grep "^version" Cargo.toml
# Expected: version = "0.2.0-alpha.1"

# Step 5: Verify version in package.json
grep '"version"' wasm/package.json
# Expected: "version": "0.2.0-alpha.1"
```

#### 2.1.2 Create Annotated Git Tag (30min)

**AGENT_ACTION:**

```bash
# Create annotated tag with release message
git tag -a v0.2.0-alpha.1 -m "Release v0.2.0-alpha.1

Alpha release of EdgeVec: High-performance vector search for Browser, Node, and Edge.

Highlights:
- HNSW indexing with O(log n) search
- Scalar Quantization (SQ8) for 3.6x memory reduction
- Sub-millisecond search at 100k scale (329µs quantized, 572µs float32)
- WASM-native with IndexedDB persistence
- 148 KB gzipped bundle (70% under 500KB target)

Performance (768d vectors, k=10):
- 10k: 88µs (SQ8) / 203µs (F32)
- 50k: 167µs (SQ8) / 480µs (F32)
- 100k: 329µs (SQ8) / 572µs (F32)

Memory: 832 MB for 1M vectors (17% under 1GB target)

Known Limitations:
- Insert/build time not optimized (batch API in v0.3.0)
- No delete/update operations (tombstones in v0.3.0)
- Single-threaded WASM execution
- Compiler optimization flags required for native builds

See CHANGELOG.md for full details.
See docs/KNOWN_LIMITATIONS.md for workarounds."

# Verify tag created
git tag -l v0.2.0-alpha.1
# Expected: v0.2.0-alpha.1

# Show tag details
git show v0.2.0-alpha.1
# Expected: Shows tag annotation and commit details
```

#### 2.1.3 Push Tag to GitHub (15min)

**AGENT_ACTION:**

```bash
# Push tag to origin
git push origin v0.2.0-alpha.1
# Expected: [new tag] v0.2.0-alpha.1 -> v0.2.0-alpha.1

# Verify tag on remote
git ls-remote --tags origin | grep v0.2.0-alpha.1
# Expected: Shows tag ref
```

#### 2.1.4 Create GitHub Release (1h)

**[USER_ACTION REQUIRED]**

```
The user must create the GitHub release:

1. Go to: https://github.com/[USERNAME]/edgevec/releases/new

2. Choose a tag: v0.2.0-alpha.1 (should appear in dropdown)

3. Release title: v0.2.0-alpha.1 — Initial Alpha Release

4. Release description (copy from below):
```

**Release Description Template:**

```markdown
## EdgeVec v0.2.0-alpha.1

High-performance vector search for Browser, Node, and Edge.

### Highlights

- **Sub-millisecond search** at 100k vectors (329µs quantized, 572µs float32)
- **3.6x memory reduction** with Scalar Quantization (SQ8)
- **148 KB bundle** (70% under 500KB target)
- **WASM-native** with IndexedDB persistence
- **Zero network latency** — runs 100% locally

### Performance (768d vectors, k=10)

| Scale | Float32 | Quantized (SQ8) |
|:------|:--------|:----------------|
| 10k | 203 µs | **88 µs** |
| 50k | 480 µs | **167 µs** |
| 100k | 572 µs | **329 µs** |

### Quick Start

```javascript
import { EdgeVecClient } from '@edgevec/core';

const client = await EdgeVecClient.create({ dimensions: 768 });
client.insert(new Float32Array(768).fill(0.1));
const results = client.search(new Float32Array(768).fill(0.1), 10);
```

### Install

```bash
npm install @edgevec/core
```

### Known Limitations

This is an **alpha release**. See [KNOWN_LIMITATIONS.md](docs/KNOWN_LIMITATIONS.md) for details.

Key limitations:
- Build time not optimized (batch insert API planned for v0.3.0)
- No delete/update operations (planned for v0.3.0)
- Single-threaded WASM execution

### Links

- [Documentation](README.md)
- [Performance Guide](docs/PERFORMANCE_GUIDE.md)
- [Changelog](CHANGELOG.md)
- [Known Limitations](docs/KNOWN_LIMITATIONS.md)

---

**Full Changelog:** See [CHANGELOG.md](CHANGELOG.md)
```

```
5. Pre-release checkbox: ✅ Check "This is a pre-release"

6. Click "Publish release"

7. Verify: Release page shows correctly at:
   https://github.com/[USERNAME]/edgevec/releases/tag/v0.2.0-alpha.1
```

#### 2.1.5 Verify GitHub Release (15min)

**AGENT_ACTION:**

```bash
# If GitHub CLI is available:
gh release view v0.2.0-alpha.1

# Manual verification (user):
# - Release visible on GitHub
# - Tag correct
# - Pre-release badge shown
# - Release notes render correctly
```

**Acceptance Criteria (W9.3):**

| Check | Pass/Fail | Verification Method | Notes |
|:------|:----------|:--------------------|:------|
| Tag created locally | [ ] | `git tag -l v0.2.0-alpha.1` | Annotated tag |
| Tag pushed to origin | [ ] | `git ls-remote --tags origin` | Remote has tag |
| GitHub release created | [ ] | GitHub web UI / `gh release view` | Release visible |
| Pre-release marked | [ ] | GitHub shows "Pre-release" badge | Alpha warning |
| Release notes accurate | [ ] | Manual check | Performance numbers match |

**Rollback (W9.3):**

```bash
# If tag needs to be recreated:
# Delete local tag
git tag -d v0.2.0-alpha.1

# Delete remote tag
git push --delete origin v0.2.0-alpha.1

# User deletes GitHub release via web UI
# Then restart from step 2.1.2

# WARNING: Do not delete tag after npm publish (version tracking)
```

---

### Part 2: npm Package Publish (W9.4 — 3.25h, was 3h)

**Owner:** WASM_SPECIALIST
**Type:** MIXED (AGENT_ACTION for build, USER_ACTION for publish)

#### 2.2.1 Build Final WASM Package (30min)

**AGENT_ACTION:**

```bash
# Navigate to wasm directory
cd wasm

# Clean previous builds
rm -rf pkg/

# Build release WASM package
wasm-pack build --target web --release
# Expected: [INFO]: Your wasm pkg is ready to publish

# Verify package contents
ls -la pkg/
# Expected: .wasm, .js, .d.ts, package.json files
```

#### 2.2.2 Verify Package Configuration (30min)

**AGENT_ACTION:**

```bash
# Check package.json version
cat wasm/package.json | grep '"version"'
# Expected: "version": "0.2.0-alpha.1"

# Check package name
cat wasm/package.json | grep '"name"'
# Expected: "name": "@edgevec/core"

# Verify package files list
npm pack --dry-run 2>&1 | head -30
# Expected: Lists ~19 files, shows package size

# Check package size
npm pack --dry-run 2>&1 | grep "total files"
# Expected: ~19 files

# Check compressed size
npm pack --dry-run 2>&1 | grep "unpacked size"
# Expected: ~300KB unpacked
```

#### 2.2.3 Test Package Installation (45min)

**AGENT_ACTION:**

```bash
# Create test directory
mkdir -p /tmp/edgevec-test-install
cd /tmp/edgevec-test-install

# Initialize test project
npm init -y

# Pack the package locally
cd /path/to/edgevec/wasm
npm pack
# Creates: edgevec-core-0.2.0-alpha.1.tgz

# Install from tarball
cd /tmp/edgevec-test-install
npm install /path/to/edgevec/wasm/edgevec-core-0.2.0-alpha.1.tgz

# Test import works
node -e "const { EdgeVecClient } = require('@edgevec/core'); console.log('SUCCESS: Package imports correctly');"
# Expected: SUCCESS: Package imports correctly

# Clean up test directory
cd /tmp && rm -rf edgevec-test-install
```

#### 2.2.4 npm Login (15min)

**[USER_ACTION REQUIRED]**

```
The user must authenticate with npm:

1. Open terminal in wasm/ directory

2. Login to npm:
   npm login

3. Enter npm credentials when prompted:
   - Username: [your npm username]
   - Password: [your npm password]
   - Email: [your email]
   - OTP (if 2FA enabled): [code from authenticator]

4. Verify login successful:
   npm whoami
   Expected: Returns your npm username
```

#### 2.2.5 Publish to npm (30min)

**[USER_ACTION REQUIRED]**

```
The user must publish the package:

1. Navigate to wasm/ directory

2. Final pre-publish check:
   npm pack --dry-run
   # Verify correct files included

3. Publish with public access:
   npm publish --access public
   # Expected: + @edgevec/core@0.2.0-alpha.1

4. If prompted for OTP (2FA), enter code from authenticator

5. Verify publication:
   npm view @edgevec/core
   # Shows package info

   npm view @edgevec/core version
   # Expected: 0.2.0-alpha.1
```

#### 2.2.6 Verify npm Package (30min)

**AGENT_ACTION (after USER publishes):**

```bash
# Create clean test directory
mkdir -p /tmp/edgevec-npm-verify
cd /tmp/edgevec-npm-verify

# Initialize project
npm init -y

# Install from npm registry
npm install @edgevec/core@0.2.0-alpha.1
# Expected: added 1 package

# Verify installation
ls node_modules/@edgevec/core/
# Expected: Shows package files

# Test import
node -e "const { EdgeVecClient } = require('@edgevec/core'); console.log('SUCCESS: npm install works');"
# Expected: SUCCESS: npm install works

# Clean up
cd /tmp && rm -rf edgevec-npm-verify
```

#### 2.2.7 Publish Failure Contingency (15min) **[PRODUCTION-CRITICAL]**

**Owner:** WASM_SPECIALIST
**Type:** AGENT_ACTION (protocols only, execute if needed)

**Rationale:** npm publish can fail for many reasons. Have explicit retry logic and timeout protocol.

**CONTINGENCY: npm Publish Hangs**

```bash
# Scenario: `npm publish` command hangs for >5 minutes

# Step 1: Wait for timeout (5min max)
# If no output after 5 minutes, abort

# Step 2: Cancel the command
# Ctrl+C to terminate

# Step 3: Check if publish succeeded anyway
npm view @edgevec/core@0.2.0-alpha.1
# If shows version: Publish succeeded despite hang (proceed to verification)
# If 404: Publish failed (proceed to retry)

# Step 4: Check npm status
curl -I https://registry.npmjs.org/
# If not 200: npm registry is down
# Action: Check https://status.npmjs.org/
# Decision: If "major outage", ABORT and reschedule Day 42 for +24h

# Step 5: Retry with exponential backoff
# Attempt 1: Immediate retry
npm publish --access public

# If fails, wait 5 minutes
# Attempt 2: Retry after 5min
sleep 300 && npm publish --access public

# If fails, wait 15 minutes
# Attempt 3: Retry after 15min (total 20min from first attempt)
sleep 900 && npm publish --access public

# If 3 attempts fail:
# ESCALATION: Postpone release by 24h
# Document incident in docs/incidents/YYYY-MM-DD-npm-publish-failure.md
```

**CONTINGENCY: npm Publish Returns Error**

| Error | Cause | Fix |
|:------|:------|:----|
| `403 Forbidden` | Auth failed | Re-run `npm login`, verify credentials |
| `ENEEDAUTH` | Not logged in | Run `npm login` |
| `E409` | Version exists | Check if accidental republish (version number wrong) |
| `EPUBLISHCONFLICT` | Publish in progress | Wait 5min, retry |
| `ETIMEOUT` | Network timeout | Check internet, retry |
| `E500 / E503` | npm registry issue | Check status.npmjs.org, wait 1h, retry |

**Maximum Retry Attempts:** 3
**Maximum Wait Time:** 30 minutes total
**Escalation Threshold:** If not resolved in 30min, postpone release 24h

**CONTINGENCY: Git Tag Exists But npm Publish Failed**

**Scenario:** You pushed git tag v0.2.0-alpha.1, but npm publish failed. This is a "split-brain" state.

```bash
# DO NOT DELETE THE GIT TAG (preserves version history)

# Option A: Fix issue and publish (if fixable in <1h)
# 1. Fix the underlying issue (auth, network, etc.)
# 2. Retry npm publish
# 3. Proceed normally

# Option B: Abort release and hotfix next day
# 1. Document failure in GitHub issue
# 2. Plan v0.2.0-alpha.2 for next day
# 3. Leave tag in place (users can clone, just not npm install)
# 4. Update social announcements: "Release delayed 24h due to registry issues"
```

**Decision Matrix:**

| Failure Time | npm Retries | Decision |
|:-------------|:------------|:---------|
| <15min into Day 42 | 0-1 | Continue, retry immediately |
| 15-30min into Day 42 | 2 | Continue, retry with 5min wait |
| 30min+ into Day 42 | 3 | ABORT: Postpone 24h, investigate root cause |
| git tag pushed, npm failed | N/A | Leave tag, retry npm OR hotfix next day |

**Acceptance Criteria (Contingency):**

| Check | Pass/Fail | Expected Output | Notes |
|:------|:----------|:----------------|:------|
| Retry protocol documented | [ ] | Protocol exists | Ready for failures |
| Timeout threshold set | [ ] | 5min per attempt | Prevents infinite hang |
| Max retries set | [ ] | 3 attempts | Prevents endless loop |
| Escalation path clear | [ ] | Postpone if 3 fails | Human decision point |

---

**Acceptance Criteria (W9.4):**

| Check | Pass/Fail | Verification Method | Notes |
|:------|:----------|:--------------------|:------|
| WASM package built | [ ] | `wasm/pkg/` exists | Release build |
| Package version correct | [ ] | `npm pack --dry-run` | 0.2.0-alpha.1 |
| Local tarball test passes | [ ] | Install from .tgz | Import works |
| npm login successful | [ ] | `npm whoami` | Auth verified |
| npm publish successful | [ ] | `npm publish` exits 0 | No errors |
| npm install works | [ ] | Fresh `npm install @edgevec/core` | Public install |
| Package page correct | [ ] | `npm view @edgevec/core` | Shows metadata |

**Rollback (W9.4):**

```bash
# If publish fails:
# 1. Check error message
# 2. Fix issue (auth, version, etc.)
# 3. Retry npm publish

# If critical bug discovered within 72 hours:
npm unpublish @edgevec/core@0.2.0-alpha.1
# NOTE: Only works within 72 hours of publish

# If >72 hours, deprecate instead:
npm deprecate @edgevec/core@0.2.0-alpha.1 "Critical bug found - use 0.2.0-alpha.2"

# WARNING: After unpublish, same version cannot be reused for 24 hours

# User notification (if rollback occurred):
# 1. Update GitHub release to mark as yanked
gh release edit v0.2.0-alpha.1 --notes "⚠️ YANKED: Critical bug discovered. Please use v0.2.0-alpha.2"

# 2. Deprecation message on npm (users see warning on install)
npm deprecate @edgevec/core@0.2.0-alpha.1 "Critical bug. Please upgrade: npm install @edgevec/core@0.2.0-alpha.2"
```

**Post-Rollback Communication:**
- Update README.md with version warning
- Post update to any social media announcements
- Respond to affected user issues with upgrade instructions

---

## 3. Tasks

### W9.3: Create Git Tag & GitHub Release (3h)

- [ ] **Verify State**
  - [ ] Confirm on main branch
  - [ ] Confirm working directory clean
  - [ ] Confirm versions match (Cargo.toml, package.json)

- [ ] **Create Tag**
  - [ ] Create annotated git tag v0.2.0-alpha.1
  - [ ] Push tag to origin

- [ ] **GitHub Release**
  - [ ] **[USER]** Create GitHub release from tag
  - [ ] **[USER]** Add release description with performance data
  - [ ] **[USER]** Mark as pre-release
  - [ ] Verify release visible on GitHub

### W9.4: npm Package Publish (3h)

- [ ] **Build Package**
  - [ ] Clean previous builds
  - [ ] Run `wasm-pack build --target web --release`
  - [ ] Verify package contents

- [ ] **Verify Package**
  - [ ] Check package.json version and name
  - [ ] Run `npm pack --dry-run`
  - [ ] Test local tarball installation

- [ ] **Publish**
  - [ ] **[USER]** Run `npm login`
  - [ ] **[USER]** Run `npm publish --access public`
  - [ ] Verify with `npm view @edgevec/core`

- [ ] **Post-Publish Verification**
  - [ ] Test fresh `npm install @edgevec/core`
  - [ ] Verify import works

---

## 4. Verification

### Verification Commands

```bash
# W9.3 - Tag verification
git tag -l v0.2.0-alpha.1 && echo "✅ Local tag exists"
git ls-remote --tags origin | grep v0.2.0-alpha.1 && echo "✅ Remote tag exists"

# W9.3 - GitHub release (if gh CLI available)
gh release view v0.2.0-alpha.1 2>/dev/null && echo "✅ GitHub release exists"

# W9.4 - Package verification
npm view @edgevec/core version 2>/dev/null && echo "✅ npm package published"

# W9.4 - Install verification
mkdir -p /tmp/verify-edgevec && cd /tmp/verify-edgevec
npm init -y && npm install @edgevec/core@0.2.0-alpha.1
node -e "require('@edgevec/core'); console.log('✅ Package imports correctly')"
cd /tmp && rm -rf verify-edgevec
```

### Acceptance Summary

| Task | Criterion | Status |
|:-----|:----------|:-------|
| W9.3 | Git tag v0.2.0-alpha.1 created and pushed | [ ] |
| W9.3 | GitHub release created with correct notes | [ ] |
| W9.3 | Pre-release badge visible | [ ] |
| W9.4 | WASM package built successfully | [ ] |
| W9.4 | npm publish completed | [ ] |
| W9.4 | Fresh npm install works | [ ] |

### Failure Modes

| Failure | Recovery Action |
|:--------|:----------------|
| Tag already exists | Delete and recreate (see rollback) |
| GitHub release fails | Check permissions; retry via web UI |
| npm login fails | Verify credentials; check 2FA |
| npm publish fails | Check version availability; fix error |
| Package import fails | Debug; unpublish if within 72h |

---

## 5. Deliverables

| Artifact | Location | Owner | Status |
|:---------|:---------|:------|:-------|
| Git tag v0.2.0-alpha.1 | Git repository | RUST_ENGINEER | [ ] |
| GitHub release | `github.com/[USER]/edgevec/releases/v0.2.0-alpha.1` | USER | [ ] |
| npm package | `npmjs.com/package/@edgevec/core` | USER | [ ] |
| WASM package build | `wasm/pkg/` | WASM_SPECIALIST | [ ] |

---

## 6. Risks & Mitigations

| Risk | Probability | Impact | Mitigation |
|:-----|:------------|:-------|:-----------|
| Tag push fails | Low | Medium | Check git remote; verify permissions |
| GitHub release fails | Low | Medium | Retry via web UI; check rate limits |
| npm auth fails | Medium | High | Verify credentials; regenerate token if needed |
| npm publish fails | Low | High | Check version availability; review error |
| Critical bug post-publish | Low | CRITICAL | Unpublish within 72h; deprecate if later |
| Package name conflict | Very Low | High | @edgevec scope should be unique |

---

## 7. Next Step

After W9D42 completion:

```bash
# Mark Day 42 complete
echo "W9D42 Complete: Git tag PUSHED. GitHub release PUBLISHED. npm package LIVE."

# Record URLs
echo "GitHub Release: https://github.com/[USERNAME]/edgevec/releases/tag/v0.2.0-alpha.1"
echo "npm Package: https://www.npmjs.com/package/@edgevec/core"

# Proceed to Day 43
# Reference: docs/planning/weeks/week9/W9D43.md
```

**Pipeline:**
W9D41 (Validation + GitHub) → **W9D42** (Tag + Publish) → W9D43 (Announce) → W9D44-45 (Monitor)

---

**Ready for Execution:** This is the critical release day. All USER_ACTION items require manual user intervention. Ensure npm and GitHub credentials are ready before starting.

---

**END OF W9D42**
