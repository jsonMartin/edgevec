# Week 2 - Day 7: The WalAppender

**Objective:** Implement the append-only logic for writing to the WAL file.

---

## Morning: RUST_ENGINEER (Appender Logic)

- [ ] Define `WalAppender` struct in `src/persistence/wal.rs`.
    - [ ] Field: `writer: BufWriter<File>` (or generic `W: Write`).
    - [ ] Field: `current_sequence: u64`.
- [ ] Implement `WalAppender::append(&mut self, type: u8, payload: &[u8]) -> Result<u64, Error>`.
    - [ ] Step 1: Calculate CRC32 of (EntryHeader + Payload).
    - [ ] Step 2: Construct `WalEntry` with current sequence.
    - [ ] Step 3: Write Header.
    - [ ] Step 4: Write Payload.
    - [ ] Step 5: Write CRC32 (4 bytes).
    - [ ] Step 6: `flush()`.
    - [ ] Step 7: Increment sequence.

## Afternoon: RUST_ENGINEER (CRC Integration)

- [ ] Add `crc32fast` dependency to `Cargo.toml`.
- [ ] Ensure every write includes the trailing CRC.
- [ ] Verification:
    - [ ] Write a test that inspects the raw bytes generated by `WalAppender`.
    - [ ] Manually verify the last 4 bytes match the expected CRC32 of the preceding bytes.

## Deliverables

- [ ] `WalAppender` can write valid entries to a file/buffer.
- [ ] All writes are flushed and include correct CRC32.

