# W5D22 - Persistence Hardening

## Goal
Ensure data integrity on disk with checksums, versioning, and corruption detection.

## Specifications
- **File Format:**
  - Header: `[MAGIC: 4b] [VERSION: 2b] [FLAGS: 2b] [CRC32: 4b]`
- **Checksum:** `crc32fast` crate.
- **Recovery:**
  - Detect truncated files (power loss).
  - Detect bit rot (CRC mismatch).

## Tasks
1. [ ] Update `FileHeader` struct in `src/storage/header.rs`.
2. [ ] Integrate `crc32fast` for header and chunk verification.
3. [ ] Implement `verify_integrity()` method in `StorageBackend`.
4. [ ] Test: `test_corrupted_header` (manually flip bits).
5. [ ] Test: `test_truncated_file` (short read).

## Acceptance
- Loading a corrupted file returns `Error::DataCorruption`, NOT panic.
- Valid files load correctly.
- Overhead of CRC calculation is <5% of load time.

