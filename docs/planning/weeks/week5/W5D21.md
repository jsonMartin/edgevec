# W5D21 - SIMD Acceleration (Stable)

## Goal
Implement SIMD-accelerated distance metrics for `x86_64` (AVX2) and `wasm32` (SIMD128) using strictly **Stable Rust**.

## Specifications
- **Constraints:**
  - **MSRV:** 1.70 (Stable).
  - **Prohibition:** NO `nightly` features (e.g., `portable-simd` is FORBIDDEN).
- **Strategy:** "Platform Intrinsics Wrapper"
  - Define a `SimdMetric` trait (or use existing `Metric` trait).
  - **WASM:** Use `std::arch::wasm32` intrinsics (v128 types) gated by `#[cfg(target_arch = "wasm32")]`.
  - **x86:** Use `std::arch::x86_64` (AVX2/FMA) gated by `#[cfg(target_arch = "x86_64")]`.
  - **Fallback:** Scalar implementation if SIMD is unavailable or feature disabled.
- **Feature Flag:** `simd`
  - If enabled: compilation attempts to use platform intrinsics.
  - Runtime detection: `is_x86_feature_detected!("avx2")` (standard on x86).
  - Compile-time detection: `#[cfg(target_feature = "simd128")]` for WASM.

## Tasks
1. [ ] Add `simd` feature to `Cargo.toml`.
2. [ ] Create `src/simd/mod.rs`, `src/simd/wasm.rs`, `src/simd/x86.rs`.
3. [ ] Implement `l2_distance` and `cosine_similarity` using `std::arch::wasm32` (Stable).
4. [ ] Implement `l2_distance` and `cosine_similarity` using `std::arch::x86_64` (AVX2).
5. [ ] Create abstraction layer (Traits) to select implementation at compile time (WASM) or runtime (x86).
6. [ ] Benchmark: `benches/distance_metrics.rs` comparing Scalar vs SIMD.

## Acceptance
- **Performance:** >4x speedup vs scalar for L2/Cosine on supported hardware.
- **Stability:** Compiles on Stable Rust 1.70+.
- **WASM:** Verified to work with `wasm-pack` and `--target web` when `simd128` is enabled.
